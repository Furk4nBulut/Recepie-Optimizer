{% extends 'base.html' %}

{% block title %}Add Step to {{ recipe.name }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'recipe_detail' recipe.id %}">{{ recipe.name }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">Add Step</li>
        </ol>
    </nav>

    <!-- Accordion Section -->
    <div class="accordion mb-4" id="helpAccordion">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    What can you do on this page?
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#helpAccordion">
                <div class="accordion-body">
                    On this page, you can add a step to the recipe "{{ recipe.name }}". Fill in the required fields including the step name, duration, and whether it occupies the chef's time. Optionally, you can also specify any prerequisite steps. Once you've filled in the details, click the "Add Step" button to save.
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm p-4">
        <h1 class="mb-4 text-center">Add Step to {{ recipe.name }}</h1>

        <form method="post" class="needs-validation" novalidate>
            {% csrf_token %}

            <!-- Step Name Field -->
            <div class="form-group">
                <label for="{{ form.name.id_for_label }}">Step Name</label>
                <input type="text" name="{{ form.name.name }}" id="{{ form.name.id_for_label }}"
                       value="{{ form.name.value|default_if_none:'' }}"
                       class="form-control"
                       placeholder="Enter the step name" required>
                <small class="form-text text-muted">Please provide a clear name for this step.</small>
                <div class="invalid-feedback">
                    Please provide a valid step name.
                </div>
            </div>

            <!-- Duration Field -->
            <div class="form-group mt-3">
                <label for="{{ form.duration.id_for_label }}">Duration (minutes)</label>
                <input type="number" name="{{ form.duration.name }}" id="{{ form.duration.id_for_label }}"
                       value="{{ form.duration.value|default_if_none:'' }}"
                       class="form-control"
                       placeholder="Enter duration in minutes" required>
                <small class="form-text text-muted">Enter the duration required for this step in minutes.</small>
            </div>

            <!-- Occupies Chef Field -->
            <div class="form-group mt-3">
                <label for="occupies_chef" class="d-flex align-items-center">
                    <i class="fas fa-chef-hat me-2"></i> Does this step occupy the chef?
                </label>
                <div class="form-check">
                    <input type="checkbox" name="occupies_chef" id="occupies_chef" class="form-check-input" {% if form.occupies_chef.value %}checked{% endif %}>
                    <label for="occupies_chef" class="form-check-label">Yes</label>
                </div>
                <small class="form-text text-muted">Check if this step will occupy the chef's time.</small>
            </div>

            <!-- Prerequisites Field -->
            <div class="form-group mt-3">
                <label for="prerequisites">Prerequisites (Optional)</label>
                <select name="prerequisites" id="prerequisites" class="form-control" multiple>
                    {% for step in recipe.steps.all %}
                        <option value="{{ step.id }}">{{ step.name }}</option>
                    {% endfor %}
                </select>
                <small class="form-text text-muted">Select any prerequisite steps if necessary.</small>
            </div>

            <!-- Submit and Back Buttons -->
            <div class="mt-4 text-center">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-plus"></i> Add Step
                </button>
                <a href="{% url 'recipe_detail' recipe.id %}" class="btn btn-secondary btn-lg ms-3">
                    <i class="fas fa-arrow-left"></i> Back to Recipe
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
